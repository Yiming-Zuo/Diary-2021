## 1.Linux系统IO和C标准库IO

```shell
fputs(buf1, fp)     ---             |--write()--
                       |-> I/O缓存 -             |->磁盘
fgets(buf2, n, fp)  ---             |--read() --
     应用程序           |   C标准IO库  |   内核     |  磁盘
```

* C标准库可以跨平台调用不同系统的api
* IO缓存区
    * C标准库有IO缓存区，减低了读写磁盘的次数（慢），提高了操作效率
    
        ```shell
        struct FILE *fp {
            文件描述符;
            文件读写指针位置;
            IO缓存区;(默认8k)
        };
        ```
    
    * Linux系统IO没有缓存区，可以应用于网络编程(实时)

## 2.虚拟内存空间
* 每一个进程操作系统都会为其分配一个0-4G的虚拟内存地址（32位）
* 虚拟内存空间实际上是不存在的，当进程创建时，虚拟内存空间会被cpu的MMU(内存管理单元)映射到物理内存中

```shell
4g  |---------------------------------------------|
内  |   内存管理                                    |   
核  |进程管理(PCB进程控制块结构体中有一个文件描述符表数组) | 
区  |   设备驱动管理                                | 
    |    vfs虚拟文件系统                            | 
3g  |---------------------------------------------| 
    |   当前用户的环境变量(env指令查看)                | 
    |---------------------------------------------| 
    |     命令行参数                                | 
    |---------------------------------------------| 
    |                                             | 
    |  栈空间(小)   向下增长                         | 
    |                                             | 
    |---------------------------------------------| 
    |                                             | 
用  |  共享库(C标准库、linux IO库、动态库)            | 
户  |---------------------------------------------| 
区  |                                             | 
    |                                             | 
    |   堆空间(大)   向上增长                        | 
    |                                             | 
    |                                             | 
    |---------------------------------------------| 
    |     .bss 未初始化全局变量                      | 
    |---------------------------------------------| 
    |     .data 已初始化全局变量                     | 
    |---------------------------------------------| 
    |     .text 代码区(二进制代码)                   | 
4K  |---------------------------------------------| 
    |     受保护的地址                              | 
    |---------------------------------------------|
```

* 内核区是软件(操作系统)通过系统调用操作
* ELF文件的主要三个段 .text .data .bss
    * 其它段：只读数据段、符号段...
* PCB中的文件描述符表(数组)    
    * 每一个进程都有一个文件描述符表
    * 默认大小1024（一个进程可以打开的最大文件数）
    * 打开新文件总占用空闲状态下最小的那个文件描述符(内核维护)
    * 同一个文件可以被打开多次且文件描述符不同
    * 0 1 2默认打开，都指向终端文件
        * 0 STDIN_FILENO
        * 1 STDOUT_FILENO
        * 2 STDERR_FILENO(perror)

## 3 Linux系统I/O函数    